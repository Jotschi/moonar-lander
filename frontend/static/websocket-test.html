<!DOCTYPE html>
<html>

<body>
    <script>
        (function () {
            "use strict";
            // https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications
            function error(err) { console.error(err); }
            var client = new WebSocket("ws://localhost:4711");
            var token = '';
            client.onmessage = function (msg) {
                let data = JSON.parse(msg.data);
                if (data.token) token = data.token;
                console.log(msg.data);
            };
            client.onerror = error;
            client.onopen = () => {
                setTimeout(() => {
                    console.log('sending name');
                    client.send(JSON.stringify({ token: token, name: "tester" }));
                }, 500);
            };
        })();
    </script>
</body>

</html>